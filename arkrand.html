<!DOCTYPE html>

<html>

<head>
  <meta charset="utf-8">
  <title>Arkham Randomizer</title>
  <link rel="stylesheet" href="arkrand.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="site.webmanifest">
<head>

<body>
  <script src="scenarios.js"></script>
  <input id="xp_input" type="text" oninput="numberOnly(this.id);" maxlength="3" placeholder="XP"/>
  <button id="submit" onclick="randomize()">Randomize Scenario</button>
  <div id="option_panel">
    <p>Show all possible scenarios: <input id="show_all" type="checkbox"/></p>
  </div>
  <div id="scenario_box" class="hidden">
    <p id="scenario_name" class="hidden">Scenario Name</p>
    <p id="scenario_note" class="hidden">Info</p>
    <p id="other_scenarios" class="hidden">others</p>
  </div>


  <script>
    let input = document.querySelector("#xp_input");
    let button = document.querySelector("#submit");
    let scenario_name = document.querySelector("#scenario_name");
    let scenario_note = document.querySelector("#scenario_note");
    let other_scenarios = document.querySelector("#other_scenarios");
    let show_all_checkbox = document.querySelector("#show_all");


    button.addEventListener("mouseover", (e) => {
      e.target.classList.add("submit_hover");
    });
    button.addEventListener("mouseout", (e) => {
      e.target.classList.remove("submit_hover");
    });

    function numberOnly(id) {
        // Get element by id which passed as parameter within HTML element event
        var element = document.getElementById(id);
        // This removes any other character but numbers as entered by user
        element.value = element.value.replace(/[^0-9]/gi, "");
    }


    function randomize()
    {
      document.querySelector("#scenario_box").classList.add("visible_box");
      document.querySelector("#scenario_box").classList.remove("hidden");


      let results = [];
      let challenges = [];

      let xp = parseInt(input.value);

      if(isNaN(xp))
      {
        scenario_note.innerHTML = "Enter an amount of XP.";
        scenario_name.classList.add("hidden");
        other_scenarios.classList.add("hidden");
        scenario_note.classList.remove("hidden");
        return;
      }

      //find all scenarios within xp range
      for(let i = 0; i < scenarios.length; i++)
      {
        if(xp >= scenarios[i]["xp_min"] && xp <= scenarios[i]["xp_max"])
        {
          results.push(scenarios[i]);
        }
        if(scenarios[i]["challenge"])
        {
          challenges.push(scenarios[i]);
        }
      }

      var scenario;
      //output a scenario to play
      if(results.length != 0)
      {
        let tries = 0;
        do
        {
          scenario = results[Math.floor(Math.random() * results.length)];
          tries += 1;
        } while(scenario_name.innerHTML == scenario["name"] && tries < 10)
      }
      else //no valid scenarios; spit out a random difficult scenario
      {
        let tries = 0;
        do
        {
          scenario = challenges[Math.floor(Math.random() * challenges.length)];
          tries += 1;
        } while(scenario_name.innerHTML == scenario["name"] && tries < 10)
      }

      //display the name of the scenario
      scenario_name.innerHTML = scenario["name"];
      scenario_name.classList.remove("hidden");
      //display one note for this scenario
      if(Object.hasOwn(scenario, 'note'))
      {
        scenario_note.innerHTML = scenario["note"][Math.floor(Math.random() * scenario["note"].length)];
        scenario_note.classList.remove("hidden");
      }
      else
      {
        scenario_note.classList.add("hidden");
      }

      //display all options
      if(show_all_checkbox.checked)
      {
        other_scenarios.classList.remove("hidden");
        other_scenarios.innerHTML = "<u>Other Scenarios:</u><br>";
        let others = results.length != 0 ? results : challenges;
        for(let i = 0; i < others.length; i++)
        {
          other_scenarios.innerHTML += "<li>" + others[i]["name"] + "<br>"
        }
      }
      else
      {
        other_scenarios.classList.add("hidden");
      }



    }
  </script>

</body>

</html
